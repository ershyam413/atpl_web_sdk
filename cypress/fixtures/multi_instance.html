<html>
<head>
    <script type='text/javascript' src='../../lib/Atpl.js'></script>
    <script type='module'>
        import { triggerStorageChange } from '../support/integration_helper.js';
        // here we implement a cookie and localStorage clearing logic
        const deleteAllCookies = () => {
            const cookies = document.cookie.split(";");
            for (const cookie of cookies) {
                const eqPos = cookie.indexOf("=");
                const name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
                document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT";
            }
        }
        window.localStorage.clear();
        deleteAllCookies();
        console.error("cleared the storage");

        // ==================================================
        // synchronously
        // ==================================================
        //initializing first instance, which will be global Atpl
        Atpl.init({
            app_key: "YOUR_APP_KEY1",
            url: "https://your.domain.Atpl",
            test_mode: true
        })
        Atpl.remove_consent();
        Atpl.disable_offline_mode();
        triggerStorageChange("YOUR_APP_KEY1/cly_id", "id1");
        triggerStorageChange("YOUR_APP_KEY3/cly_id", "id3");
        Atpl.add_event({ key: "test", count: 1, sum: 1, dur: 1, segmentation: { test: "test" } });
        Atpl.start_event("test");
        Atpl.cancel_event("gobbledygook");
        Atpl.end_event("test");
        Atpl.report_conversion("camp_id", "camp_user_id");
        Atpl.recordDirectAttribution("camp_id", "camp_user_id");
        Atpl.user_details({ name: "name" });
        Atpl.userData.set("set", "set");
        Atpl.userData.save();
        Atpl.report_trace({ name: "name", stz: 1, type: "type" });
        Atpl.log_error({ error: "error", stack: "stack" });
        Atpl.add_log("error");
        Atpl.fetch_remote_config();
        Atpl.enrollUserToAb();
        Atpl.track_sessions();
        Atpl.track_pageview();
        Atpl.track_errors();
        Atpl.track_clicks();
        Atpl.track_scrolls();
        Atpl.track_links();
        Atpl.track_forms();
        Atpl.collect_from_forms();
        Atpl.collect_from_facebook();
        Atpl.opt_in();

        //initialize second instance for another app synchronously
        var Atpl2 = Atpl.init({
            app_key: "YOUR_APP_KEY2", //must have different APP key
            url: "https://your.domain.Atpl",
            test_mode: true

        });
        Atpl2.remove_consent();
        Atpl2.disable_offline_mode();
        Atpl2.add_event({ key: "test", count: 1, sum: 1, dur: 1, segmentation: { test: "test" } });
        Atpl2.start_event("test");
        Atpl2.cancel_event("gobbledygook");
        Atpl2.end_event("test");
        Atpl2.report_conversion("camp_id", "camp_user_id");
        Atpl2.recordDirectAttribution("camp_id", "camp_user_id");
        Atpl2.user_details({ name: "name" });
        Atpl2.userData.set("set", "set");
        Atpl2.userData.save();
        Atpl2.report_trace({ name: "name", stz: 1, type: "type" });
        Atpl2.log_error({ error: "error", stack: "stack" });
        Atpl2.add_log("error");
        Atpl2.fetch_remote_config();
        Atpl2.enrollUserToAb();
        Atpl2.track_sessions();
        Atpl2.track_pageview();
        Atpl2.track_errors();
        Atpl2.track_clicks();
        Atpl2.track_scrolls();
        Atpl2.track_links();
        Atpl2.track_forms();
        Atpl2.collect_from_forms();
        Atpl2.collect_from_facebook();
        Atpl2.opt_in();

        // ==================================================
        // asynchronously
        // ==================================================
        //initialize third instance for another app asynchronously
        Atpl.q.push(["init", {
            app_key: "YOUR_APP_KEY3", //must have different APP key
            url: "https://your.domain.Atpl",
            test_mode: true

        }])
        Atpl.q.push(["YOUR_APP_KEY3", "remove_consent"]);
        Atpl.q.push(["YOUR_APP_KEY3", "disable_offline_mode"]);
        Atpl.q.push(["YOUR_APP_KEY3", "add_event", { key: "test", count: 1, sum: 1, dur: 1, segmentation: { test: "test" } }]);
        Atpl.q.push(["YOUR_APP_KEY3", "start_event", "test"]);
        Atpl.q.push(["YOUR_APP_KEY3", "cancel_event", "gobbledygook"]);
        Atpl.q.push(["YOUR_APP_KEY3", "end_event", "test"]);
        Atpl.q.push(["YOUR_APP_KEY3", "report_conversion", "camp_id", "camp_user_id"]);
        Atpl.q.push(["YOUR_APP_KEY3", "recordDirectAttribution", "camp_id", "camp_user_id"]);
        Atpl.q.push(["YOUR_APP_KEY3", "user_details", { name: "name" }]);
        Atpl.q.push(["YOUR_APP_KEY3", "userData.set", "set", "set"]);
        Atpl.q.push(["YOUR_APP_KEY3", "userData.save"]);
        Atpl.q.push(["YOUR_APP_KEY3", "report_trace", { name: "name", stz: 1, type: "type" }]);
        Atpl.q.push(["YOUR_APP_KEY3", "log_error", { error: "error", stack: "stack" }]);
        Atpl.q.push(["YOUR_APP_KEY3", "add_log", "error"]);
        Atpl.q.push(["YOUR_APP_KEY3", "fetch_remote_config"]);
        Atpl.q.push(["YOUR_APP_KEY3", "enrollUserToAb"]);
        Atpl.q.push(["YOUR_APP_KEY3", "track_sessions"]);
        Atpl.q.push(["YOUR_APP_KEY3", "track_pageview"]);
        Atpl.q.push(["YOUR_APP_KEY3", "track_errors"]);
        Atpl.q.push(["YOUR_APP_KEY3", "track_clicks"]);
        Atpl.q.push(["YOUR_APP_KEY3", "track_scrolls"]);
        Atpl.q.push(["YOUR_APP_KEY3", "track_links"]);
        Atpl.q.push(["YOUR_APP_KEY3", "track_forms"]);
        Atpl.q.push(["YOUR_APP_KEY3", "collect_from_forms"]);
        Atpl.q.push(["YOUR_APP_KEY3", "collect_from_facebook"]);
        Atpl.q.push(["YOUR_APP_KEY3", "opt_in"]);

        //initialize fourth instance for another app asynchronously
        Atpl.q.push(["init", {
            app_key: "YOUR_APP_KEY4", //must have different APP key
            url: "https://your.domain.Atpl",
            test_mode: true

        }])
        Atpl.q.push(["YOUR_APP_KEY4", "remove_consent"]);
        Atpl.q.push(["YOUR_APP_KEY4", "disable_offline_mode"]);
        Atpl.q.push(["YOUR_APP_KEY4", "add_event", { key: "test", count: 1, sum: 1, dur: 1, segmentation: { test: "test" } }]);
        Atpl.q.push(["YOUR_APP_KEY4", "start_event", "test"]);
        Atpl.q.push(["YOUR_APP_KEY4", "cancel_event", "gobbledygook"]);
        Atpl.q.push(["YOUR_APP_KEY4", "end_event", "test"]);
        Atpl.q.push(["YOUR_APP_KEY4", "report_conversion", "camp_id", "camp_user_id"]);
        Atpl.q.push(["YOUR_APP_KEY4", "recordDirectAttribution", "camp_id", "camp_user_id"]);
        Atpl.q.push(["YOUR_APP_KEY4", "user_details", { name: "name" }]);
        Atpl.q.push(["YOUR_APP_KEY4", "userData.set", "set", "set"]);
        Atpl.q.push(["YOUR_APP_KEY4", "userData.save"]);
        Atpl.q.push(["YOUR_APP_KEY4", "report_trace", { name: "name", stz: 1, type: "type" }]);
        Atpl.q.push(["YOUR_APP_KEY4", "log_error", { error: "error", stack: "stack" }]);
        Atpl.q.push(["YOUR_APP_KEY4", "add_log", "error"]);
        Atpl.q.push(["YOUR_APP_KEY4", "fetch_remote_config"]);
        Atpl.q.push(["YOUR_APP_KEY4", "enrollUserToAb"]);
        Atpl.q.push(["YOUR_APP_KEY4", "track_sessions"]);
        Atpl.q.push(["YOUR_APP_KEY4", "track_pageview"]);
        Atpl.q.push(["YOUR_APP_KEY4", "track_errors"]);
        Atpl.q.push(["YOUR_APP_KEY4", "track_clicks"]);
        Atpl.q.push(["YOUR_APP_KEY4", "track_scrolls"]);
        Atpl.q.push(["YOUR_APP_KEY4", "track_links"]);
        Atpl.q.push(["YOUR_APP_KEY4", "track_forms"]);
        Atpl.q.push(["YOUR_APP_KEY4", "collect_from_forms"]);
        Atpl.q.push(["YOUR_APP_KEY4", "collect_from_facebook"]);
        Atpl.q.push(["YOUR_APP_KEY4", "opt_in"]);
    </script>
</head>
</html>